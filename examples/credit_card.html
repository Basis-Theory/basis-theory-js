<html>
  <head>
    <title>Credit Card example</title>
    <!-- Add BasisTheory SDK -->
    <script src="../lib/dist/basis-theory-js.bundle.js"></script>
  </head>
  <body>
    <style>
      .header {
        grid-column: span 3;
      }
      .mr-1 {
        margin-right: 1em;
      }
      form {
        max-width: 480px;
      }
      .submit {
        display: flex;
        justify-content: flex-end;
      }
      .cards {
        display: flex;
        flex-wrap: wrap;
      }
      .card {
        min-width: 400px;
        background-color: #eee;
        border: 1px solid #ccc;
        padding: 1em;
        margin: 1em;
        border-radius: 1em;
      }
      .card-info {
        display: flex;
        justify-content: space-between;
      }
    </style>
    <script>
      // you can initialize the library whenever it is more suitable to you
      // here we are doing it when the window is properly loaded
      window.addEventListener('load', function () {
        BasisTheory.init('123456789', 'local'); // pass your API Key and enviroment
        // or
        // window.BasisTheory.init('123456789');
      });

      // listener for form submit event
      function onSubmit($event) {
        // tell the user agent not to handle the event
        $event.preventDefault();

        // get the underlying event target (our credit card form)
        const form = $event.target;

        // extract data from form elements
        const cardNumber = document.getElementById('card_number').value;
        const holderName = document.getElementById('holder_name').value;
        const expiration = document.getElementById('expiration').value;
        const cvv = document.getElementById('cvv').value;

        // this is where the magic happens
        // invoke async BasisTheory Payments API store credit card method
        BasisTheory.payments
          .storeCreditCard({
            cardNumber: cardNumber,
            holderName: holderName,
            expiration: expiration,
            cvv: cvv,
          })
          .then(function (card) {
            // and when that is done
            form.reset(); // we can reset our form
            handleNewCard(card); // and attach the stored credit card info to the view
          });
      }

      function handleNewCard(card) {
        const wrapper = document.getElementById('cards_wrapper');
        const newCardDiv = document.createElement('div');
        newCardDiv.className = 'card';
        newCardDiv.innerHTML =
          '<h3>' +
          card.info.holderName +
          '</h3>' +
          '<div class="card-info">' +
          card.info.cardNumber +
          '</div>' +
          '<div class="card-info">' +
          '<span>' +
          card.info.expiration +
          '</span>' +
          '<a href="#" onclick="alert(\'' +
          card.token +
          '\'); return true;">see token</a>' +
          '</div>';
        wrapper.appendChild(newCardDiv);
      }
    </script>

    <!-- This is where our stored credit cards will go -->
    <div id="cards_wrapper" class="cards"></div>
    <hr />
    <!-- We don't want the form to reload the page; hence `return false` -->
    <form onsubmit="onSubmit(event); return false;">
      <h2 class="header">Add New Credit Card</h2>
      <div>
        <label for="holder_name" class="mr-1">Holder Name:</label>
        <input
          class="span2"
          type="text"
          id="holder_name"
          name="holder_name"
          required
        />
      </div>
      <div>
        <label for="card_number" class="mr-1">Card Number:</label>
        <input
          type="text"
          id="card_number"
          name="card_number"
          class="span2"
          maxlength="16"
          required
        />
      </div>
      <div>
        <label for="expiration" class="mr-1">Expiration:</label>
        <input
          type="text"
          id="expiration"
          name="expiration"
          maxlength="5"
          size="5"
          required
        />
        <label for="cvv" class="mr-1">CVV:</label>
        <input
          type="text"
          id="cvv"
          name="cvv"
          maxlength="3"
          size="3"
          required
        />
      </div>
      <div class="submit">
        <input type="submit" value="Add Card" class="button" />
      </div>
    </form>
  </body>
</html>
